<html lang="en" ng-controller="GameCtrl">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Angular Material style sheet -->
  <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/angular_material/1.1.0-rc2/angular-material.min.css">
</head>
<body ng-app="gameApp" ng-cloak>
  <!--
    Your HTML content here
  -->
  <div ui-view>
  </div>

  <!-- Angular Material requires Angular.js Libraries -->
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular-animate.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular-aria.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular-messages.min.js"></script>
  <script src="/js/angular-ui-router.min.js"></script>

  <!-- Angular Material Library -->
  <script src="http://ajax.googleapis.com/ajax/libs/angular_material/1.1.0-rc2/angular-material.min.js"></script>

  <!-- Firebase -->
  <script src="https://cdn.firebase.com/js/client/2.2.4/firebase.js"></script>
  <!-- AngularFire -->
  <script src="https://cdn.firebase.com/libs/angularfire/1.2.0/angularfire.min.js"></script>


  <!-- Your application bootstrap  -->
  <script type="text/javascript">

    // Instantiate angular
    var app = angular.module("gameApp", ["firebase", "ngMaterial", "ui.router"]);

    // Angular settings
    app.config(['$interpolateProvider', '$stateProvider', '$urlRouterProvider',
      function($interpolateProvider, $stateProvider, $urlRouterProvider) {

        // Prevent conflicts with jinja templates
        $interpolateProvider.startSymbol('{[');
        $interpolateProvider.endSymbol(']}');


        // Generate a default game id for the day
        var d = new Date();
        var todaysGameId = d.getMonth() + "" + d.getDate();

        // Handle routing for the app
        $stateProvider
            .state('game', {
                url: '/game/:gameId',
                templateUrl: '/templates/game.html',
                controller: 'GameCtrl'
            });
        $urlRouterProvider.otherwise('/game/' + todaysGameId);

      }
    ]);

    // Main controller for the game
    app.controller("GameCtrl", function($scope, $firebaseObject, $firebaseArray, $state, $stateParams) {

      // Game id as stored in firebase
      var gameId = $state.params.gameId;

      // download the data into a local object
      var cardsPath = new Firebase("https://brett-tom-game.firebaseio.com/cards");
      var gamePath = new Firebase("https://brett-tom-game.firebaseio.com/games/" + gameId);
      $scope.cards = $firebaseObject(cardsPath);
      $scope.game = $firebaseObject(gamePath);

      // putting a console.log here won't work, see below
      $scope.cards.$watch(function() {

        // The starting decks and world will get generated
        var startingDeck = [];
        var worldDeck = [];

        // Go through each card in the dictionary
        angular.forEach($scope.cards, function(value, key) {
          console.log(value, key);
        })

        // Details about the current game
        $scope.game.$watch(function() {

          console.log('empty but triggers');

          // Go through each post in the room
          angular.forEach($scope.game, function(value, key) {
            console.log('empty out');
            console.log(value, key);
          })

        }); // $scope.game

      }); // $scope.cards


    }); // app.controller
  </script>

</body>
</html>

<!--
Copyright 2016 Google Inc. All Rights Reserved.
Use of this source code is governed by an MIT-style license that can be in foundin the LICENSE file at http://material.angularjs.org/license.
-->